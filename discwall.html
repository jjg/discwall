<html>
	<head>
		<title>murfie disc wall</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
		<style>
			@import url(resources/headers.css);
			
			body{
				background-color: #262626;
			}

			ul.music,
			ul.music li,
			ul.music li a,
			ul.music li img{
				margin:0;
				padding:0;
				list-style:none;
				border:0;
				text-decoration:none;
			}

			ul.music li{
				margin:15px 15px 15px 0;
				float:left;
				position:relative;
			}

			ul.music li a{
				display:block;
				position:relative;
				background:url(img/jewel.png) 0 0 no-repeat;
				float:left;
				width:90px;
				height:82px;
				text-indent:-1000em;
				overflow:hidden;
				z-index:1;
			}

			ul.music li img{
				position:absolute;
				width:72px;
				height:72px;
				left:12px;
				top:3px;
			}

			ul.music li{
				background:url(img/blank_insert.gif) 12px 3px no-repeat;
			}
		</style>
		<script type='text/javascript' src='js/jquery-1.9.1.js'></script>
		<script src="js/bootstrap.min.js"></script>
		<script>
			$(document).ready(function(){

				// wire-up events
				$('#loginButton').on('click', function(){

					authenticate($('#inputEmail').val(), $('#inputPassword').val(), function(authToken){

						if(authToken != null){

							// hide login form
							$('#loginForm').modal('hide');

							// load discs
							loadDiscs(authToken);
						} else {

							// display login error
							console.log('authentication failed');

							$('#loginControls').addClass('error');
							alert('sorry, error logging in');
						}
					});
				});

				// show login
				$('#loginForm').modal('show');
			});

			function authenticate(memberEmail, memberPassword, callback){

				var authToken = null;

				$.post('https://www.murfie.com/api/tokens', {email:memberEmail, password:memberPassword})
				.done(function(data){

					authToken = data['user']['token'];

					callback(authToken);
				})
				.fail(function(){
					callback(null);
				});				
			}

			function loadDiscs(authToken){

				// load the discs!
				$.getJSON('https://www.murfie.com/api/discs.json?auth_token=' + authToken, function(data){

					for(var i=0;i<data.length;i++){

						// debug
						//console.log(data[i]);

						var disc_id = data[i]['disc']['id'];
						var disc_title = data[i]['disc']['album']['title'];				
						var disc_album_art = data[i]['disc']['album']['album_art'];
						var disc_artist_name = data[i]['disc']['album']['main_artist'];
						var disc_album_url = data[i]['disc']['album']['url'];

						$("#disc_wall").append("<li><a href=\"#\" onClick=\"showDisc(\'" + disc_id + "\',\'" + disc_album_art + "\',\'" + disc_title + "\',\'" + disc_artist_name + "\',\'" + disc_album_url + "\')\">" + disc_title + "</a><img src='" + disc_album_art + "'/>");
					}
				});
			}

			function loadDisc(discId){
				$.getJSON('https://www.murfie.com/api/discs/' + discId + '.json', function(data){

					var disc_tracks = data.disc.tracks; 

					for(var i=0;i<disc_tracks.length;i++){

						var track_id = disc_tracks[i]['id'];
						var track_title = disc_tracks[i]['title'];
						var track_duration = disc_tracks[i]['duration'];
						
						console.log(track_id + ':' + track_title + ':' + track_duration);
						
					}

				});
			}

			function showDisc(discId, artURL, albumName, artistName, albumURL){
				
				$('#albumViewImage').attr('src',artURL);
				$('#albumViewTitle').text(albumName);
				$('#albumViewArtist').text(artistName);
				$('#albumViewUrl').attr('href',albumURL);
				$('#albumView').modal('show');

				loadDisc(discId);

			}
		</script>
	</head>
	<body>
		
		<div id="loginForm" class="modal hide fade">
			<div class="modal-header">				
				<h3>Login to Murfie</h3>
			</div>
			<div class="modal-body">
				<form class="form-horizontal">
					<div class="control-group">
						<label class="control-label" for="inputEmail">email</label>
						<div class="controls">
							<input id="inputEmail" type="text" placeholder="your@email.com">
						</div>
					</div>
					<div class="control-group">
						<label class="control-label" for="inputPassword">password</label>
						<div class="controls">						
							<input id="inputPassword" type="password" placeholder="secret">
						</div>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<a href="#" id="loginButton" class="btn btn-primary">Login</a>
			</div>
		</div>

		<div id="albumView" class="modal hide fade">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h3 id="albumViewArtist">Artist</h3>				
			</div>
			<div class="modal-body">
				<div class="media">
					<a class="pull-left" href="#">
						<img id="albumViewImage" class="media-object" src="8063-large.jpg">
					</a>
					<div class="media-body">
						<h4 id="albumViewTitle" class="media-heading">Album</h4>
						<span id="albumViewContent">
							<table id="albumViewTracks" class="table table-striped table-bordered">
								<tr><th>#</th><th>Title</th></tr>
								<tr><td>1</td><td>Foo</td></tr>
								<tr><td>2</td><td>Foo</td></tr>
								<tr><td>3</td><td>Foo</td></tr>
								<tr><td>4</td><td>Foo</td></tr>
								<tr><td>5</td><td>Foo</td></tr>
							</table>
							<a id="albumViewUrl" href="#">buy on Murfie</a>
						</span>
					</div>
				</div>
			</div>
		</div>

		<ul id="disc_wall" class="music">
		</ul>

	</body>
</html>